<!DOCTYPE html>
<!-- saved from url=(0048)https://www.a1k0n.net/2011/07/20/donut-math.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Donut math: how donut.c works – a1k0n.net</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Andy Sloane">
    <meta name="keywords" content="">
    <link rel="canonical" href="http://www.a1k0n.net/2011/07/20/donut-math.html">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for a1k0n.net" href="https://www.a1k0n.net/feed.xml">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="./Donut math_ how donut.c works – a1k0n.net_files/pixyll.css" type="text/css">

    <!-- Fonts -->
    <link href="./Donut math_ how donut.c works – a1k0n.net_files/css" rel="stylesheet" type="text/css">
    <link href="./Donut math_ how donut.c works – a1k0n.net_files/css(1)" rel="stylesheet" type="text/css">
    

    <!-- Verifications -->
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Donut math&amp;#58; how donut.c works">
    <meta property="og:description" content="">
    <meta property="og:url" content="http://www.a1k0n.net/2011/07/20/donut-math.html">
    <meta property="og:site_name" content="a1k0n.net">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    
        <meta name="twitter:site" content="@a1k0n">
    
    <meta name="twitter:title" content="Donut math: how donut.c works">
    <meta name="twitter:description" content="">
    <meta name="twitter:url" content="http://www.a1k0n.net/2011/07/20/donut-math.html">

    
    <script type="text/javascript" async="" src="./Donut math_ how donut.c works – a1k0n.net_files/ga.js"></script><script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-24584703-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
<script src="./Donut math_ how donut.c works – a1k0n.net_files/donut.js"></script>
<script type="text/javascript" async="" src="./Donut math_ how donut.c works – a1k0n.net_files/MathJax.js"></script>

<meta id="ConnectiveDocSignExtentionInstalled" name="ConnectiveDocSignExtentionInstalled" data-extension-version="1.0.6"><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.0') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.0') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">@font-face {font-family: MathJax_AMS; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff?V=2.7.0') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf?V=2.7.0') format('opentype')}
</style></head>

<body class="site" data-new-gr-c-s-check-loaded="14.1024.0" data-gr-ext-installed=""><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>

	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="https://www.a1k0n.net/" class="site-title">a1k0n.net</a>
      <nav class="site-nav">
        <a href="https://www.a1k0n.net/about.html">About</a>

      </nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        <div class="post-header mb2">
  <h1>Donut math: how donut.c works</h1>
  <span class="post-meta">Jul 20, 2011</span><br>
  
</div>

<article class="post-content">
  <p>[<strong>Update 1/13/2021</strong>: I wrote a follow-up with <a href="https://www.a1k0n.net/2021/01/13/optimizing-donut.html">some optimizations</a>. ]</p>

<p>There has been a sudden resurgence of interest in my <a href="https://www.a1k0n.net/2006/09/15/obfuscated-c-donut.html">“donut” code from 2006</a>, and I’ve
had a couple requests to explain this one.  It’s been five years now, so it’s
not exactly fresh in my memory, so I will reconstruct it from scratch, in great
detail, and hopefully get approximately the same result.</p>

<p>This is the code:</p>
<pre style="font-size: 10pt;">             k;double sin()
         ,cos();main(){float A=
       0,B=0,i,j,z[1760];char b[
     1760];printf("\x1b[2J");for(;;
  ){memset(b,32,1760);memset(z,0,7040)
  ;for(j=0;6.28&gt;j;j+=0.07)for(i=0;6.28
 &gt;i;i+=0.02){float c=sin(i),d=cos(j),e=
 sin(A),f=sin(j),g=cos(A),h=d+2,D=1/(c*
 h*e+f*g+5),l=cos      (i),m=cos(B),n=s\
in(B),t=c*h*g-f*        e;int x=40+30*D*
(l*h*m-t*n),y=            12+15*D*(l*h*n
+t*m),o=x+80*y,          N=8*((f*e-c*d*g
 )*m-c*d*e-f*g-l        *d*n);if(22&gt;y&amp;&amp;
 y&gt;0&amp;&amp;x&gt;0&amp;&amp;80&gt;x&amp;&amp;D&gt;z[o]){z[o]=D;;;b[o]=
 ".,-~:;=!*#$@"[N&gt;0?N:0];}}/*#****!!-*/
  printf("\x1b[H");for(k=0;1761&gt;k;k++)
   putchar(k%80?b[k]:10);A+=0.04;B+=
     0.02;}}/*****####*******!!=;:~
       ~::==!!!**********!!!==::-
         .,~~;;;========;;;:~-.
             ..,--------,*/
</pre>
<p>…and the output, animated in Javascript:
<button onclick="anim1();">toggle animation</button></p>
<pre id="d" style="background-color:#000; color:#ccc; font-size: 10pt;">                                                                               
                                                                               
                                                                               
                                                                               
                                   $@@@@@@@@@@                                 
                              $$@$$$$$####$$$$$$@@@                            
                           $$$$$$##**!***!****##$$$$$$                         
                         $$$$$$#**!*!!!===!!!!!*##$$$$$$                       
                       *$$$$$$#*!=!=;:~~~~::;==!**#$$$$$$#                     
                      *$$$$$$#**==:~-,.....,~::=!*##$$$$$$#                    
                     !#$$$$$$#*!=:~,.........-:;!*##$$$$$$#!                   
                     *#$$$$$$$#*=:,.        ..:=*##$$$$$$$#*                   
                    =*#$$$$$$$$#*=~          ~=*##$$$$$$$$#*=                  
                    =*##$$$@@$$$$#*=        !*##$$$$$$$$$#**;                  
                    ;!*#$$$@@@@@@$$$###**###$$$$$$$$$$$$##*!;                  
                    :!*###$$$@@@@@@@@@@@$$@@@@@@@$$$$$$#**!;                   
                     =!**##$$$$$@@@@@@@@@@@@@@@$$$$$###***!;                   
                     -=!!***##$$$$$$$$$$$$$$$$$$$####**!!=;                    
                      ~;=!!!***###$$$$$$$$$$$####****!!!=:                     
                       ,~;=!!!*******######******!*!!!;;~                      
                         -~;;=!!!**!***!!!!!!!!!!===;:-                        
                           .-~:;;===!!!!!!!===;=;::~,                          
</pre>

<p>At its core, it’s a framebuffer and a Z-buffer into which I render pixels.
Since it’s just rendering relatively low-resolution ASCII art, I massively
cheat.  All it does is plot pixels along the surface of the torus at
fixed-angle increments, and does it densely enough that the final result looks
solid.  The “pixels” it plots are ASCII characters corresponding to the
illumination value of the surface at each point: <code class="language-plaintext highlighter-rouge">.,-~:;=!*#$@</code> from dimmest to
brightest.  No raytracing required.</p>

<p>So how do we do that?  Well, let’s start with the basic math behind 3D
perspective rendering.  The following diagram is a side view of a person
sitting in front of a screen, viewing a 3D object behind it.</p>

<center><img src="./Donut math_ how donut.c works – a1k0n.net_files/perspective.png"></center>

<p>To render a 3D object onto a 2D screen, we project each point (<em>x</em>,<em>y</em>,<em>z</em>) in
3D-space onto a plane located <em>z’</em> units away from the viewer, so that the
corresponding 2D position is (<em>x’</em>,<em>y’</em>).  Since we’re looking from the side,
we can only see the <em>y</em> and <em>z</em> axes, but the math works the same for the <em>x</em>
axis (just pretend this is a top view instead).  This projection is really easy
to obtain: notice that the origin, the <em>y</em>-axis, and point (<em>x</em>,<em>y</em>,<em>z</em>) form a
right triangle, and a similar right triangle is formed with (<em>x’</em>,<em>y’</em>,<em>z’</em>).
Thus the relative proportions are maintained:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mfrac&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mfrac&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mfrac&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 6.057em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.729em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(-0.389em, 1004.49em, 4.416em, -999.998em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mtable" id="MathJax-Span-3" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 4.416em; height: 0px;"><span style="position: absolute; clip: rect(2.424em, 1001.17em, 6.721em, -999.998em); top: -5.076em; left: 0em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(2.424em, 1001.17em, 4.807em, -999.998em); top: -5.076em; right: 0em;"><span class="mtd" id="MathJax-Span-4"><span class="mrow" id="MathJax-Span-5"><span class="mfrac" id="MathJax-Span-6"><span style="display: inline-block; position: relative; width: 0.939em; height: 0px; margin-right: 0.119em; margin-left: 0.119em;"><span style="position: absolute; clip: rect(3.127em, 1000.82em, 4.299em, -999.998em); top: -4.646em; left: 50%; margin-left: -0.389em;"><span class="msup" id="MathJax-Span-7"><span style="display: inline-block; position: relative; width: 0.822em; height: 0px;"><span style="position: absolute; clip: rect(3.439em, 1000.51em, 4.299em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-8" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.334em; left: 0.549em;"><span class="mo" id="MathJax-Span-9" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1000.78em, 4.104em, -999.998em); top: -3.279em; left: 50%; margin-left: -0.389em;"><span class="msup" id="MathJax-Span-10"><span style="display: inline-block; position: relative; width: 0.783em; height: 0px;"><span style="position: absolute; clip: rect(3.439em, 1000.47em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-11" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.256em; left: 0.51em;"><span class="mo" id="MathJax-Span-12" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.861em, 1000.94em, 1.174em, -999.998em); top: -1.287em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 0.939em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.049em, 1000.82em, 4.299em, -999.998em); top: -2.654em; right: 0em;"><span class="mtd" id="MathJax-Span-20"><span class="mrow" id="MathJax-Span-21"><span class="msup" id="MathJax-Span-22"><span style="display: inline-block; position: relative; width: 0.822em; height: 0px;"><span style="position: absolute; clip: rect(3.439em, 1000.51em, 4.299em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-23" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.549em;"><span class="mo" id="MathJax-Span-24" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.08em;"></span></span><span style="position: absolute; clip: rect(2.893em, 1003.17em, 7.385em, -999.998em); top: -5.232em; left: 1.174em;"><span style="display: inline-block; position: relative; width: 3.244em; height: 0px;"><span style="position: absolute; clip: rect(2.736em, 1002.19em, 4.807em, -999.998em); top: -5.076em; left: 0em;"><span class="mtd" id="MathJax-Span-13"><span class="mrow" id="MathJax-Span-14"><span class="mi" id="MathJax-Span-15"></span><span class="mo" id="MathJax-Span-16" style="font-family: MathJax_Main; padding-left: 0.275em;">=</span><span class="mfrac" id="MathJax-Span-17" style="padding-left: 0.275em;"><span style="display: inline-block; position: relative; width: 0.627em; height: 0px; margin-right: 0.119em; margin-left: 0.119em;"><span style="position: absolute; clip: rect(3.439em, 1000.51em, 4.299em, -999.998em); top: -4.646em; left: 50%; margin-left: -0.232em;"><span class="mi" id="MathJax-Span-18" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.439em, 1000.47em, 4.104em, -999.998em); top: -3.279em; left: 50%; margin-left: -0.232em;"><span class="mi" id="MathJax-Span-19" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.861em, 1000.63em, 1.174em, -999.998em); top: -1.287em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 0.627em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(2.424em, 1003.17em, 4.807em, -999.998em); top: -2.654em; left: 0em;"><span class="mtd" id="MathJax-Span-25"><span class="mrow" id="MathJax-Span-26"><span class="mi" id="MathJax-Span-27"></span><span class="mo" id="MathJax-Span-28" style="font-family: MathJax_Main; padding-left: 0.275em;">=</span><span class="mfrac" id="MathJax-Span-29" style="padding-left: 0.275em;"><span style="display: inline-block; position: relative; width: 1.408em; height: 0px; margin-right: 0.119em; margin-left: 0.119em;"><span style="position: absolute; clip: rect(3.127em, 1001.29em, 4.299em, -999.998em); top: -4.646em; left: 50%; margin-left: -0.623em;"><span class="mrow" id="MathJax-Span-30"><span class="mi" id="MathJax-Span-31" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="msup" id="MathJax-Span-32"><span style="display: inline-block; position: relative; width: 0.783em; height: 0px;"><span style="position: absolute; clip: rect(3.439em, 1000.47em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-33" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.334em; left: 0.51em;"><span class="mo" id="MathJax-Span-34" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.439em, 1000.47em, 4.104em, -999.998em); top: -3.279em; left: 50%; margin-left: -0.232em;"><span class="mi" id="MathJax-Span-35" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.861em, 1001.41em, 1.174em, -999.998em); top: -1.287em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 1.408em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.236em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.647em; border-left: 0px solid; width: 0px; height: 5.952em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd><mfrac><msup><mi>y</mi><mo>′</mo></msup><msup><mi>z</mi><mo>′</mo></msup></mfrac></mtd><mtd><mi></mi><mo>=</mo><mfrac><mi>y</mi><mi>z</mi></mfrac></mtd></mtr><mtr><mtd><msup><mi>y</mi><mo>′</mo></msup></mtd><mtd><mi></mi><mo>=</mo><mfrac><mrow><mi>y</mi><msup><mi>z</mi><mo>′</mo></msup></mrow><mi>z</mi></mfrac><mo>.</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">\begin{aligned}
\frac{y'}{z'} &= \frac{y}{z} \\
y' &= \frac{y z'}{z}.
\end{aligned}</script>

<p>So to project a 3D coordinate to 2D, we scale a coordinate by the screen
distance <em>z’</em>.  Since <em>z’</em> is a fixed constant, and not functionally a
coordinate, let’s rename it to <em>K<sub>1</sub></em>, so our projection equation
becomes <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mfrac&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-37" style="width: 11.174em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.713em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(1.135em, 1008.63em, 2.736em, -999.998em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-38"><span class="mo" id="MathJax-Span-39" style="font-family: MathJax_Main;">(</span><span class="msup" id="MathJax-Span-40"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; clip: rect(3.439em, 1000.51em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-41" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.334em; left: 0.588em;"><span class="mo" id="MathJax-Span-42" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-43" style="font-family: MathJax_Main;">,</span><span class="msup" id="MathJax-Span-44" style="padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 0.822em; height: 0px;"><span style="position: absolute; clip: rect(3.439em, 1000.51em, 4.299em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-45" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.334em; left: 0.549em;"><span class="mo" id="MathJax-Span-46" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-47" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-48" style="font-family: MathJax_Main; padding-left: 0.275em;">=</span><span class="mo" id="MathJax-Span-49" style="font-family: MathJax_Main; padding-left: 0.275em;">(</span><span class="mfrac" id="MathJax-Span-50"><span style="display: inline-block; position: relative; width: 1.447em; height: 0px; margin-right: 0.119em; margin-left: 0.119em;"><span style="position: absolute; clip: rect(3.4em, 1001.29em, 4.221em, -999.998em); top: -4.49em; left: 50%; margin-left: -0.662em;"><span class="mrow" id="MathJax-Span-51"><span class="msubsup" id="MathJax-Span-52"><span style="display: inline-block; position: relative; width: 0.9em; height: 0px;"><span style="position: absolute; clip: rect(3.4em, 1000.63em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-53" style="font-size: 70.7%; font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.865em; left: 0.588em;"><span class="mn" id="MathJax-Span-54" style="font-size: 50%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-55" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.557em, 1000.31em, 4.104em, -999.998em); top: -3.631em; left: 50%; margin-left: -0.154em;"><span class="mi" id="MathJax-Span-56" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.861em, 1001.45em, 1.174em, -999.998em); top: -1.287em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 1.447em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span><span class="mo" id="MathJax-Span-57" style="font-family: MathJax_Main;">,</span><span class="mfrac" id="MathJax-Span-58" style="padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 1.369em; height: 0px; margin-right: 0.119em; margin-left: 0.119em;"><span style="position: absolute; clip: rect(3.4em, 1001.25em, 4.26em, -999.998em); top: -4.529em; left: 50%; margin-left: -0.623em;"><span class="mrow" id="MathJax-Span-59"><span class="msubsup" id="MathJax-Span-60"><span style="display: inline-block; position: relative; width: 0.9em; height: 0px;"><span style="position: absolute; clip: rect(3.4em, 1000.63em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-61" style="font-size: 70.7%; font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.865em; left: 0.588em;"><span class="mn" id="MathJax-Span-62" style="font-size: 50%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-63" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.557em, 1000.31em, 4.104em, -999.998em); top: -3.631em; left: 50%; margin-left: -0.154em;"><span class="mi" id="MathJax-Span-64" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.861em, 1001.37em, 1.174em, -999.998em); top: -1.287em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 1.369em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span><span class="mo" id="MathJax-Span-65" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.852em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msup><mi>x</mi><mo>′</mo></msup><mo>,</mo><msup><mi>y</mi><mo>′</mo></msup><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mfrac><mrow><msub><mi>K</mi><mn>1</mn></msub><mi>x</mi></mrow><mi>z</mi></mfrac><mo>,</mo><mfrac><mrow><msub><mi>K</mi><mn>1</mn></msub><mi>y</mi></mrow><mi>z</mi></mfrac><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-2">(x',y') = (\frac{K_1 x}{z}, \frac{K_1 y}{z})</script>.  We can choose
<em>K<sub>1</sub></em> arbitrarily based on the field of view we want to show in our
2D window.  For example, if we have a 100x100 window of pixels, then the view
is centered at (50,50); and if we want to see an object which is 10 units wide
in our 3D space, set back 5 units from the viewer, then <em>K<sub>1</sub></em> should
be chosen so that the projection of the point <em>x</em>=10, <em>z</em>=5 is still on the
screen with <em>x’</em> &lt; 50: 10<em>K<sub>1</sub></em>/5 &lt; 50, or <em>K<sub>1</sub></em> &lt; 25.</p>

<p>When we’re plotting a bunch of points, we might end up plotting different
points at the same (<em>x’</em>,<em>y’</em>) location but at different depths, so we maintain
a <a href="http://en.wikipedia.org/wiki/Z-buffering">z-buffer</a> which stores
the <em>z</em> coordinate of everything we draw.  If we need to plot a location, we
first check to see whether we’re plotting in front of what’s there already.  It
also helps to compute <em>z</em><sup>-1</sup> <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-66" style="width: 2.268em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.76em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(1.291em, 1001.76em, 2.736em, -999.998em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-67"><span class="mo" id="MathJax-Span-68" style="font-family: MathJax_Main;">=</span><span class="mfrac" id="MathJax-Span-69" style="padding-left: 0.275em;"><span style="display: inline-block; position: relative; width: 0.471em; height: 0px; margin-right: 0.119em; margin-left: 0.119em;"><span style="position: absolute; clip: rect(3.4em, 1000.31em, 4.104em, -999.998em); top: -4.373em; left: 50%; margin-left: -0.193em;"><span class="mn" id="MathJax-Span-70" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.557em, 1000.31em, 4.104em, -999.998em); top: -3.631em; left: 50%; margin-left: -0.154em;"><span class="mi" id="MathJax-Span-71" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.861em, 1000.47em, 1.174em, -999.998em); top: -1.287em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 0.471em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.652em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>=</mo><mfrac><mn>1</mn><mi>z</mi></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-3">= \frac{1}{z}</script> and use that when depth
buffering because:</p>

<ul>
  <li><em>z</em><sup>-1</sup> = 0 corresponds to infinite depth, so we can pre-initialize
our z-buffer to 0 and have the background be infinitely far away</li>
  <li>we can re-use <em>z</em><sup>-1</sup> when computing <em>x’</em> and <em>y’</em>:
Dividing once and multiplying by <em>z</em><sup>-1</sup> twice is cheaper than
dividing by <em>z</em> twice.</li>
</ul>

<p>Now, how do we draw a donut, AKA <a href="http://en.wikipedia.org/wiki/Torus">torus</a>?  Well, a torus is a <a href="http://en.wikipedia.org/wiki/Solid_of_revolution">solid of
revolution</a>, so one way to do it is to draw a 2D circle around some point in
3D space, and then rotate it around the central axis of the torus.  Here is a
cross-section through the center of a torus:</p>

<center><img src="./Donut math_ how donut.c works – a1k0n.net_files/torusxsec.png"></center>

<p>So we have a circle of radius <em>R</em><sub>1</sub> centered at point
(<em>R</em><sub>2</sub>,0,0), drawn on the <em>xy</em>-plane.  We can draw this by sweeping
an angle — let’s call it <em>θ</em> — from 0 to 2π:</p>

<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-72" style="width: 23.322em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.205em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(1.408em, 1018.13em, 2.619em, -999.998em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-73"><span class="mo" id="MathJax-Span-74" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-75" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-76" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-77" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-78" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-79" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-80" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-81" style="font-family: MathJax_Main; padding-left: 0.275em;">=</span><span class="mo" id="MathJax-Span-82" style="font-family: MathJax_Main; padding-left: 0.275em;">(</span><span class="msubsup" id="MathJax-Span-83"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-84" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-85" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-86" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-87" style="font-family: MathJax_Main; padding-left: 0.158em;">0</span><span class="mo" id="MathJax-Span-88" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-89" style="font-family: MathJax_Main; padding-left: 0.158em;">0</span><span class="mo" id="MathJax-Span-90" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-91" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="mo" id="MathJax-Span-92" style="font-family: MathJax_Main; padding-left: 0.236em;">(</span><span class="msubsup" id="MathJax-Span-93"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-94" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-95" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-96" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-97"></span><span class="mi" id="MathJax-Span-98" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-99" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-100" style="padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-101" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-102" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-103" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-104"></span><span class="mi" id="MathJax-Span-105" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-106" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-107" style="font-family: MathJax_Main; padding-left: 0.158em;">0</span><span class="mo" id="MathJax-Span-108" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.348em; border-left: 0px solid; width: 0px; height: 1.403em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>R</mi><mn>2</mn></msub><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>,</mo><msub><mi>R</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-4">
(x,y,z) = (R_2,0,0) + (R_1 \cos \theta, R_1 \sin \theta, 0)
</script></p>

<p>Now we take that circle and rotate it around the <em>y</em>-axis by another angle
— let’s call it φ.  To rotate an arbitrary 3D point around one of the
cardinal axes, the standard technique is to multiply by a <a href="http://en.wikipedia.org/wiki/Rotation_matrix">rotation matrix</a>.  So if
we take the previous points and rotate about the <em>y</em>-axis we get:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-109" style="width: 29.924em; display: inline-block;"><span style="display: inline-block; position: relative; width: 23.361em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(2.15em, 1023.09em, 6.174em, -999.998em); top: -4.412em; left: 0em;"><span class="mrow" id="MathJax-Span-110"><span class="mrow" id="MathJax-Span-111"><span class="mo" id="MathJax-Span-112" style="font-family: MathJax_Main;">(</span><span class="mtable" id="MathJax-Span-113" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 11.994em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1005.98em, 4.338em, -999.998em); top: -3.982em; left: 0em;"><span style="display: inline-block; position: relative; width: 6.018em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1005.98em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -3.006em;"><span class="mtd" id="MathJax-Span-114"><span class="mrow" id="MathJax-Span-115"><span class="msubsup" id="MathJax-Span-116"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-117" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-118" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-119" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-120" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-121" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-122" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-123" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-124"></span><span class="mi" id="MathJax-Span-125" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-126" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1003.4em, 4.338em, -999.998em); top: -3.982em; left: 7.033em;"><span style="display: inline-block; position: relative; width: 3.479em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1003.4em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.756em;"><span class="mtd" id="MathJax-Span-127"><span class="mrow" id="MathJax-Span-128"><span class="msubsup" id="MathJax-Span-129"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-130" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-131" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-132" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-133"></span><span class="mi" id="MathJax-Span-134" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-135" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.244em, 1000.47em, 4.182em, -999.998em); top: -3.982em; left: 11.525em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-136"><span class="mrow" id="MathJax-Span-137"><span class="mn" id="MathJax-Span-138" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-139" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-140" style="font-family: MathJax_Main; padding-left: 0.236em;">⋅</span><span class="mrow" id="MathJax-Span-141" style="padding-left: 0.236em;"><span class="mo" id="MathJax-Span-142" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mtable" id="MathJax-Span-143" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 7.502em; height: 0px;"><span style="position: absolute; clip: rect(2.541em, 1002.89em, 6.447em, -999.998em); top: -4.686em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.932em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1002.07em, 4.299em, -999.998em); top: -5.35em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-144"><span class="mrow" id="MathJax-Span-145"><span class="mi" id="MathJax-Span-146" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-147"></span><span class="mi" id="MathJax-Span-148" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-157"><span class="mrow" id="MathJax-Span-158"><span class="mn" id="MathJax-Span-159" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.89em, 4.299em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.443em;"><span class="mtd" id="MathJax-Span-166"><span class="mrow" id="MathJax-Span-167"><span class="mo" id="MathJax-Span-168" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-169" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-170"></span><span class="mi" id="MathJax-Span-171" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.689em;"></span></span><span style="position: absolute; clip: rect(2.346em, 1000.47em, 6.096em, -999.998em); top: -4.49em; left: 3.908em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-149"><span class="mrow" id="MathJax-Span-150"><span class="mn" id="MathJax-Span-151" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.43em, 4.104em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-160"><span class="mrow" id="MathJax-Span-161"><span class="mn" id="MathJax-Span-162" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-172"><span class="mrow" id="MathJax-Span-173"><span class="mn" id="MathJax-Span-174" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span><span style="position: absolute; clip: rect(2.541em, 1002.07em, 6.447em, -999.998em); top: -4.686em; left: 5.432em;"><span style="display: inline-block; position: relative; width: 2.111em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1001.96em, 4.299em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.975em;"><span class="mtd" id="MathJax-Span-152"><span class="mrow" id="MathJax-Span-153"><span class="mi" id="MathJax-Span-154" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-155"></span><span class="mi" id="MathJax-Span-156" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-163"><span class="mrow" id="MathJax-Span-164"><span class="mn" id="MathJax-Span-165" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.07em, 4.299em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-175"><span class="mrow" id="MathJax-Span-176"><span class="mi" id="MathJax-Span-177" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-178"></span><span class="mi" id="MathJax-Span-179" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.689em;"></span></span></span></span><span class="mo" id="MathJax-Span-180" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.416em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.147em; border-left: 0px solid; width: 0px; height: 5.002em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><msub><mi>R</mi><mn>2</mn></msub><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>,</mo></mtd><mtd><msub><mi>R</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>,</mo></mtd><mtd><mn>0</mn></mtd></mtr></mtable><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi></mtd><mtd><mn>0</mn></mtd><mtd><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mn>1</mn></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi></mtd><mtd><mn>0</mn></mtd><mtd><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi></mtd></mtr></mtable><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-5">\left( \begin{matrix}
R_2 + R_1 \cos \theta, &
R_1 \sin \theta, &
0 \end{matrix} \right)
\cdot
\left( \begin{matrix}
\cos \phi & 0 & \sin \phi \\
0 & 1 & 0 \\
-\sin \phi & 0 & \cos \phi \end{matrix} \right)</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-181" style="width: 33.479em; display: inline-block;"><span style="display: inline-block; position: relative; width: 26.135em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(1.369em, 1026.06em, 2.658em, -999.998em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-182"><span class="mo" id="MathJax-Span-183" style="font-family: MathJax_Main;">=</span><span class="mrow" id="MathJax-Span-184" style="padding-left: 0.275em;"><span class="mo" id="MathJax-Span-185" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mtable" id="MathJax-Span-186" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 23.986em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1008.99em, 4.377em, -999.998em); top: -3.982em; left: 0em;"><span style="display: inline-block; position: relative; width: 9.064em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1008.99em, 4.338em, -999.998em); top: -3.943em; left: 50%; margin-left: -4.529em;"><span class="mtd" id="MathJax-Span-187"><span class="mrow" id="MathJax-Span-188"><span class="mo" id="MathJax-Span-189" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-190"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-191" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-192" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-193" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-194" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-195" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-196" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-197" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-198"></span><span class="mi" id="MathJax-Span-199" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-200" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-201" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-202"></span><span class="mi" id="MathJax-Span-203" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span><span class="mo" id="MathJax-Span-204" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1003.4em, 4.338em, -999.998em); top: -3.982em; left: 10.041em;"><span style="display: inline-block; position: relative; width: 3.479em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1003.4em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.756em;"><span class="mtd" id="MathJax-Span-205"><span class="mrow" id="MathJax-Span-206"><span class="msubsup" id="MathJax-Span-207"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-208" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-209" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-210" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-211"></span><span class="mi" id="MathJax-Span-212" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-213" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.127em, 1009.42em, 4.377em, -999.998em); top: -3.982em; left: 14.533em;"><span style="display: inline-block; position: relative; width: 9.455em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1009.42em, 4.338em, -999.998em); top: -3.943em; left: 50%; margin-left: -4.725em;"><span class="mtd" id="MathJax-Span-214"><span class="mrow" id="MathJax-Span-215"><span class="mo" id="MathJax-Span-216" style="font-family: MathJax_Main;">−</span><span class="mo" id="MathJax-Span-217" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-218"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-219" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-220" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-221" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-222" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-223" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-224" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-225" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-226"></span><span class="mi" id="MathJax-Span-227" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-228" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-229" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-230"></span><span class="mi" id="MathJax-Span-231" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-232" style=""><span style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.398em; border-left: 0px solid; width: 0px; height: 1.453em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>=</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mo stretchy="false">(</mo><msub><mi>R</mi><mn>2</mn></msub><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo stretchy="false">)</mo><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi><mo>,</mo></mtd><mtd><msub><mi>R</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>,</mo></mtd><mtd><mo>−</mo><mo stretchy="false">(</mo><msub><mi>R</mi><mn>2</mn></msub><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi></mtd></mtr></mtable><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-6">= \left( \begin{matrix}
(R_2 + R_1 \cos \theta)\cos \phi, &
R_1 \sin \theta, &
-(R_2 + R_1 \cos \theta)\sin \phi \end{matrix} \right)</script>

<p>But wait: we also want the whole donut to spin around on at least two more axes
for the animation.  They were called <em>A</em> and <em>B</em> in the original code: it was a
rotation about the <em>x</em>-axis by <em>A</em> and a rotation about the <em>z</em>-axis by <em>B</em>.
This is a bit hairier, so I’m not even going write the result yet, but it’s a
bunch of matrix multiplies.</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-233" style="width: 57.111em; display: inline-block;"><span style="display: inline-block; position: relative; width: 44.611em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(2.15em, 1044.34em, 6.174em, -999.998em); top: -4.412em; left: 0em;"><span class="mrow" id="MathJax-Span-234"><span class="mrow" id="MathJax-Span-235"><span class="mo" id="MathJax-Span-236" style="font-family: MathJax_Main;">(</span><span class="mtable" id="MathJax-Span-237" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 11.994em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1005.98em, 4.338em, -999.998em); top: -3.982em; left: 0em;"><span style="display: inline-block; position: relative; width: 6.018em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1005.98em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -3.006em;"><span class="mtd" id="MathJax-Span-238"><span class="mrow" id="MathJax-Span-239"><span class="msubsup" id="MathJax-Span-240"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-241" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-242" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-243" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-244" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-245" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-246" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-247" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-248"></span><span class="mi" id="MathJax-Span-249" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-250" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1003.4em, 4.338em, -999.998em); top: -3.982em; left: 7.033em;"><span style="display: inline-block; position: relative; width: 3.479em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1003.4em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.756em;"><span class="mtd" id="MathJax-Span-251"><span class="mrow" id="MathJax-Span-252"><span class="msubsup" id="MathJax-Span-253"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-254" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-255" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-256" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-257"></span><span class="mi" id="MathJax-Span-258" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-259" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.244em, 1000.47em, 4.182em, -999.998em); top: -3.982em; left: 11.525em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-260"><span class="mrow" id="MathJax-Span-261"><span class="mn" id="MathJax-Span-262" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-263" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-264" style="font-family: MathJax_Main; padding-left: 0.236em;">⋅</span><span class="mrow" id="MathJax-Span-265" style="padding-left: 0.236em;"><span class="mo" id="MathJax-Span-266" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mtable" id="MathJax-Span-267" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 7.502em; height: 0px;"><span style="position: absolute; clip: rect(2.541em, 1002.89em, 6.447em, -999.998em); top: -4.686em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.932em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1002.07em, 4.299em, -999.998em); top: -5.35em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-268"><span class="mrow" id="MathJax-Span-269"><span class="mi" id="MathJax-Span-270" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-271"></span><span class="mi" id="MathJax-Span-272" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-281"><span class="mrow" id="MathJax-Span-282"><span class="mn" id="MathJax-Span-283" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.89em, 4.299em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.443em;"><span class="mtd" id="MathJax-Span-290"><span class="mrow" id="MathJax-Span-291"><span class="mo" id="MathJax-Span-292" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-293" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-294"></span><span class="mi" id="MathJax-Span-295" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.689em;"></span></span><span style="position: absolute; clip: rect(2.346em, 1000.47em, 6.096em, -999.998em); top: -4.49em; left: 3.908em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-273"><span class="mrow" id="MathJax-Span-274"><span class="mn" id="MathJax-Span-275" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.43em, 4.104em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-284"><span class="mrow" id="MathJax-Span-285"><span class="mn" id="MathJax-Span-286" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-296"><span class="mrow" id="MathJax-Span-297"><span class="mn" id="MathJax-Span-298" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span><span style="position: absolute; clip: rect(2.541em, 1002.07em, 6.447em, -999.998em); top: -4.686em; left: 5.432em;"><span style="display: inline-block; position: relative; width: 2.111em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1001.96em, 4.299em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.975em;"><span class="mtd" id="MathJax-Span-276"><span class="mrow" id="MathJax-Span-277"><span class="mi" id="MathJax-Span-278" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-279"></span><span class="mi" id="MathJax-Span-280" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-287"><span class="mrow" id="MathJax-Span-288"><span class="mn" id="MathJax-Span-289" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.07em, 4.299em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-299"><span class="mrow" id="MathJax-Span-300"><span class="mi" id="MathJax-Span-301" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-302"></span><span class="mi" id="MathJax-Span-303" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.689em;"></span></span></span></span><span class="mo" id="MathJax-Span-304" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-305" style="font-family: MathJax_Main; padding-left: 0.236em;">⋅</span><span class="mrow" id="MathJax-Span-306" style="padding-left: 0.236em;"><span class="mo" id="MathJax-Span-307" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mtable" id="MathJax-Span-308" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 7.814em; height: 0px;"><span style="position: absolute; clip: rect(2.346em, 1000.47em, 6.096em, -999.998em); top: -4.49em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.43em, 4.104em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-309"><span class="mrow" id="MathJax-Span-310"><span class="mn" id="MathJax-Span-311" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-318"><span class="mrow" id="MathJax-Span-319"><span class="mn" id="MathJax-Span-320" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-331"><span class="mrow" id="MathJax-Span-332"><span class="mn" id="MathJax-Span-333" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span><span style="position: absolute; clip: rect(2.385em, 1003.05em, 6.174em, -999.998em); top: -4.529em; left: 1.486em;"><span style="display: inline-block; position: relative; width: 3.088em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-312"><span class="mrow" id="MathJax-Span-313"><span class="mn" id="MathJax-Span-314" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.23em, 4.104em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.131em;"><span class="mtd" id="MathJax-Span-321"><span class="mrow" id="MathJax-Span-322"><span class="mi" id="MathJax-Span-323" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-324"></span><span class="mi" id="MathJax-Span-325" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1003.05em, 4.182em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.521em;"><span class="mtd" id="MathJax-Span-334"><span class="mrow" id="MathJax-Span-335"><span class="mo" id="MathJax-Span-336" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-337" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-338"></span><span class="mi" id="MathJax-Span-339" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.533em;"></span></span><span style="position: absolute; clip: rect(2.346em, 1002.23em, 6.057em, -999.998em); top: -4.49em; left: 5.588em;"><span style="display: inline-block; position: relative; width: 2.229em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-315"><span class="mrow" id="MathJax-Span-316"><span class="mn" id="MathJax-Span-317" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.11em, 4.104em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-326"><span class="mrow" id="MathJax-Span-327"><span class="mi" id="MathJax-Span-328" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-329"></span><span class="mi" id="MathJax-Span-330" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.23em, 4.104em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.131em;"><span class="mtd" id="MathJax-Span-340"><span class="mrow" id="MathJax-Span-341"><span class="mi" id="MathJax-Span-342" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-343"></span><span class="mi" id="MathJax-Span-344" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span></span></span><span class="mo" id="MathJax-Span-345" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-346" style="font-family: MathJax_Main; padding-left: 0.236em;">⋅</span><span class="mrow" id="MathJax-Span-347" style="padding-left: 0.236em;"><span class="mo" id="MathJax-Span-348" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mtable" id="MathJax-Span-349" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 7.854em; height: 0px;"><span style="position: absolute; clip: rect(2.346em, 1003.09em, 6.096em, -999.998em); top: -4.49em; left: 0em;"><span style="display: inline-block; position: relative; width: 3.088em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1002.27em, 4.104em, -999.998em); top: -5.35em; left: 50%; margin-left: -1.131em;"><span class="mtd" id="MathJax-Span-350"><span class="mrow" id="MathJax-Span-351"><span class="mi" id="MathJax-Span-352" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-353"></span><span class="mi" id="MathJax-Span-354" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1003.09em, 4.182em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.521em;"><span class="mtd" id="MathJax-Span-363"><span class="mrow" id="MathJax-Span-364"><span class="mo" id="MathJax-Span-365" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-366" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-367"></span><span class="mi" id="MathJax-Span-368" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-377"><span class="mrow" id="MathJax-Span-378"><span class="mn" id="MathJax-Span-379" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span><span style="position: absolute; clip: rect(2.346em, 1002.27em, 6.096em, -999.998em); top: -4.49em; left: 4.064em;"><span style="display: inline-block; position: relative; width: 2.268em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1002.15em, 4.104em, -999.998em); top: -5.35em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-355"><span class="mrow" id="MathJax-Span-356"><span class="mi" id="MathJax-Span-357" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-358"></span><span class="mi" id="MathJax-Span-359" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1002.27em, 4.104em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.131em;"><span class="mtd" id="MathJax-Span-369"><span class="mrow" id="MathJax-Span-370"><span class="mi" id="MathJax-Span-371" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-372"></span><span class="mi" id="MathJax-Span-373" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-380"><span class="mrow" id="MathJax-Span-381"><span class="mn" id="MathJax-Span-382" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span><span style="position: absolute; clip: rect(2.307em, 1000.47em, 6.018em, -999.998em); top: -4.451em; left: 7.346em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-360"><span class="mrow" id="MathJax-Span-361"><span class="mn" id="MathJax-Span-362" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-374"><span class="mrow" id="MathJax-Span-375"><span class="mn" id="MathJax-Span-376" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.43em, 4.104em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-383"><span class="mrow" id="MathJax-Span-384"><span class="mn" id="MathJax-Span-385" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.455em;"></span></span></span></span><span class="mo" id="MathJax-Span-386" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.416em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.147em; border-left: 0px solid; width: 0px; height: 5.002em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><msub><mi>R</mi><mn>2</mn></msub><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>,</mo></mtd><mtd><msub><mi>R</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>,</mo></mtd><mtd><mn>0</mn></mtd></mtr></mtable><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi></mtd><mtd><mn>0</mn></mtd><mtd><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mn>1</mn></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi></mtd><mtd><mn>0</mn></mtd><mtd><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi></mtd></mtr></mtable><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mn>1</mn></mtd><mtd><mn>0</mn></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mi>cos</mi><mo>⁡</mo><mi>A</mi></mtd><mtd><mi>sin</mi><mo>⁡</mo><mi>A</mi></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>A</mi></mtd><mtd><mi>cos</mi><mo>⁡</mo><mi>A</mi></mtd></mtr></mtable><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>cos</mi><mo>⁡</mo><mi>B</mi></mtd><mtd><mi>sin</mi><mo>⁡</mo><mi>B</mi></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>B</mi></mtd><mtd><mi>cos</mi><mo>⁡</mo><mi>B</mi></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mn>0</mn></mtd><mtd><mn>1</mn></mtd></mtr></mtable><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-7">\left( \begin{matrix}
R_2 + R_1 \cos \theta, &
R_1 \sin \theta, &
0 \end{matrix} \right)
\cdot
\left( \begin{matrix}
\cos \phi & 0 & \sin \phi \\
0 & 1 & 0 \\
-\sin \phi & 0 & \cos \phi \end{matrix} \right)
\cdot
\left( \begin{matrix}
1 & 0 & 0 \\
0 & \cos A & \sin A \\
0 & -\sin A & \cos A \end{matrix} \right)
\cdot
\left( \begin{matrix}
\cos B & \sin B & 0 \\
-\sin B & \cos B & 0 \\
0 & 0 & 1 \end{matrix} \right)</script>

<p>Churning through the above gets us an (<em>x</em>,<em>y</em>,<em>z</em>) point on the surface of our
torus, rotated around two axes, centered at the origin.  To actually get screen
coordinates, we need to:</p>

<ul>
  <li>Move the torus somewhere in front of the viewer (the viewer is at the
origin) — so we just add some constant to <em>z</em> to move it backward.</li>
  <li>Project from 3D onto our 2D screen.</li>
</ul>

<p>So we have another constant to pick, call it <em>K</em><sub>2</sub>, for the distance
of the donut from the viewer, and our projection now looks like:</p>

<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-387" style="width: 16.525em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.893em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(1.838em, 1012.7em, 4.455em, -999.998em); top: -3.396em; left: 0em;"><span class="mrow" id="MathJax-Span-388"><span class="mrow" id="MathJax-Span-389"><span class="mo" id="MathJax-Span-390" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-391"><span class="msup" id="MathJax-Span-392"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; clip: rect(3.439em, 1000.51em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-393" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.588em;"><span class="mo" id="MathJax-Span-394" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-395" style="font-family: MathJax_Main;">,</span><span class="msup" id="MathJax-Span-396" style="padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 0.822em; height: 0px;"><span style="position: absolute; clip: rect(3.439em, 1000.51em, 4.299em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-397" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.549em;"><span class="mo" id="MathJax-Span-398" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-399" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-400" style="font-family: MathJax_Main; padding-left: 0.275em;">=</span><span class="mrow" id="MathJax-Span-401" style="padding-left: 0.275em;"><span class="mo" id="MathJax-Span-402" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">(</span></span><span class="mrow" id="MathJax-Span-403"><span class="mfrac" id="MathJax-Span-404"><span style="display: inline-block; position: relative; width: 3.127em; height: 0px; margin-right: 0.119em; margin-left: 0.119em;"><span style="position: absolute; clip: rect(3.205em, 1001.8em, 4.26em, -999.998em); top: -4.646em; left: 50%; margin-left: -0.936em;"><span class="mrow" id="MathJax-Span-405"><span class="msubsup" id="MathJax-Span-406"><span style="display: inline-block; position: relative; width: 1.291em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-407" style="font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.861em;"><span class="mn" id="MathJax-Span-408" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-409" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1003.01em, 4.26em, -999.998em); top: -3.279em; left: 50%; margin-left: -1.482em;"><span class="mrow" id="MathJax-Span-410"><span class="msubsup" id="MathJax-Span-411"><span style="display: inline-block; position: relative; width: 1.291em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-412" style="font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.861em;"><span class="mn" id="MathJax-Span-413" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-414" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="mi" id="MathJax-Span-415" style="font-family: MathJax_Math-italic; padding-left: 0.236em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.861em, 1003.13em, 1.174em, -999.998em); top: -1.287em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 3.127em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span><span class="mo" id="MathJax-Span-416" style="font-family: MathJax_Main;">,</span><span class="mfrac" id="MathJax-Span-417" style="padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 3.127em; height: 0px; margin-right: 0.119em; margin-left: 0.119em;"><span style="position: absolute; clip: rect(3.205em, 1001.76em, 4.299em, -999.998em); top: -4.646em; left: 50%; margin-left: -0.896em;"><span class="mrow" id="MathJax-Span-418"><span class="msubsup" id="MathJax-Span-419"><span style="display: inline-block; position: relative; width: 1.291em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-420" style="font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.861em;"><span class="mn" id="MathJax-Span-421" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-422" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1003.01em, 4.26em, -999.998em); top: -3.279em; left: 50%; margin-left: -1.482em;"><span class="mrow" id="MathJax-Span-423"><span class="msubsup" id="MathJax-Span-424"><span style="display: inline-block; position: relative; width: 1.291em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-425" style="font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.861em;"><span class="mn" id="MathJax-Span-426" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-427" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="mi" id="MathJax-Span-428" style="font-family: MathJax_Math-italic; padding-left: 0.236em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(0.861em, 1003.13em, 1.174em, -999.998em); top: -1.287em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 3.127em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.057em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-429" style="vertical-align: 0em;"><span style="font-family: MathJax_Size3;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 3.4em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.248em; border-left: 0px solid; width: 0px; height: 3.152em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>(</mo><mrow><msup><mi>x</mi><mo>′</mo></msup><mo>,</mo><msup><mi>y</mi><mo>′</mo></msup></mrow><mo>)</mo></mrow><mo>=</mo><mrow><mo>(</mo><mrow><mfrac><mrow><msub><mi>K</mi><mn>1</mn></msub><mi>x</mi></mrow><mrow><msub><mi>K</mi><mn>2</mn></msub><mo>+</mo><mi>z</mi></mrow></mfrac><mo>,</mo><mfrac><mrow><msub><mi>K</mi><mn>1</mn></msub><mi>y</mi></mrow><mrow><msub><mi>K</mi><mn>2</mn></msub><mo>+</mo><mi>z</mi></mrow></mfrac></mrow><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-8">
\left( x’, y’ \right)
=
\left( \frac{K_1 x}{K_2 + z} , \frac{K_1 y}{K_2 + z} \right)
</script></p>

<p><em>K</em><sub>1</sub> and <em>K</em><sub>2</sub> can be tweaked together to change the field
of view and flatten or exaggerate the depth of the object.</p>

<p>Now, we could implement a 3x3 matrix multiplication routine in our code and
implement the above in a straightforward way.  But if our goal is to shrink the
code as much as possible, then every 0 in the matrices above is an opportunity
for simplification.  So let’s multiply it out.  Churning through a bunch of
algebra (thanks Mathematica!), the full result is:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-430" style="width: 44.729em; display: inline-block;"><span style="display: inline-block; position: relative; width: 34.924em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(2.15em, 1034.65em, 6.33em, -999.998em); top: -4.49em; left: 0em;"><span class="mrow" id="MathJax-Span-431"><span class="mrow" id="MathJax-Span-432"><span class="mo" id="MathJax-Span-433" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mtable" id="MathJax-Span-434" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 0.588em; height: 0px;"><span style="position: absolute; clip: rect(2.346em, 1000.51em, 5.822em, -999.998em); top: -4.256em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.588em; height: 0px;"><span style="position: absolute; clip: rect(3.439em, 1000.51em, 4.104em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.271em;"><span class="mtd" id="MathJax-Span-435"><span class="mrow" id="MathJax-Span-436"><span class="mi" id="MathJax-Span-437" style="font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.439em, 1000.51em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-438"><span class="mrow" id="MathJax-Span-439"><span class="mi" id="MathJax-Span-440" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.439em, 1000.47em, 4.104em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-441"><span class="mrow" id="MathJax-Span-442"><span class="mi" id="MathJax-Span-443" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.26em;"></span></span></span></span><span class="mo" id="MathJax-Span-444" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-445" style="font-family: MathJax_Main; padding-left: 0.275em;">=</span><span class="mrow" id="MathJax-Span-446" style="padding-left: 0.275em;"><span class="mo" id="MathJax-Span-447" style="vertical-align: 2.229em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.662em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.717em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mtable" id="MathJax-Span-448" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 28.908em; height: 0px;"><span style="position: absolute; clip: rect(2.58em, 1028.91em, 6.721em, -999.998em); top: -4.881em; left: 0em;"><span style="display: inline-block; position: relative; width: 28.908em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1028.79em, 4.338em, -999.998em); top: -5.389em; left: 50%; margin-left: -14.412em;"><span class="mtd" id="MathJax-Span-449"><span class="mrow" id="MathJax-Span-450"><span class="mo" id="MathJax-Span-451" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-452"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-453" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-454" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-455" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-456" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-457" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-458" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-459" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-460"></span><span class="mi" id="MathJax-Span-461" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-462" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-463" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-464" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-465"></span><span class="mi" id="MathJax-Span-466" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span><span class="mi" id="MathJax-Span-467" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-468"></span><span class="mi" id="MathJax-Span-469" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span><span class="mo" id="MathJax-Span-470" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="mi" id="MathJax-Span-471" style="font-family: MathJax_Main; padding-left: 0.236em;">sin</span><span class="mo" id="MathJax-Span-472"></span><span class="mi" id="MathJax-Span-473" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mi" id="MathJax-Span-474" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-475"></span><span class="mi" id="MathJax-Span-476" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span><span class="mi" id="MathJax-Span-477" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-478"></span><span class="mi" id="MathJax-Span-479" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span><span class="mo" id="MathJax-Span-480" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-481" style="font-family: MathJax_Main; padding-left: 0.236em;">−</span><span class="msubsup" id="MathJax-Span-482" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-483" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-484" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-485" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-486"></span><span class="mi" id="MathJax-Span-487" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mi" id="MathJax-Span-488" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-489"></span><span class="mi" id="MathJax-Span-490" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span><span class="mi" id="MathJax-Span-491" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-492"></span><span class="mi" id="MathJax-Span-493" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.127em, 1028.91em, 4.338em, -999.998em); top: -3.943em; left: 50%; margin-left: -14.451em;"><span class="mtd" id="MathJax-Span-494"><span class="mrow" id="MathJax-Span-495"><span class="mo" id="MathJax-Span-496" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-497"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-498" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-499" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-500" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-501" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-502" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-503" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-504" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-505"></span><span class="mi" id="MathJax-Span-506" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-507" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-508" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-509" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-510"></span><span class="mi" id="MathJax-Span-511" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span><span class="mi" id="MathJax-Span-512" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-513"></span><span class="mi" id="MathJax-Span-514" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span><span class="mo" id="MathJax-Span-515" style="font-family: MathJax_Main; padding-left: 0.236em;">−</span><span class="mi" id="MathJax-Span-516" style="font-family: MathJax_Main; padding-left: 0.236em;">cos</span><span class="mo" id="MathJax-Span-517"></span><span class="mi" id="MathJax-Span-518" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span><span class="mi" id="MathJax-Span-519" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-520"></span><span class="mi" id="MathJax-Span-521" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mi" id="MathJax-Span-522" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-523"></span><span class="mi" id="MathJax-Span-524" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span><span class="mo" id="MathJax-Span-525" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-526" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-527" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-528" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-529" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-530" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-531"></span><span class="mi" id="MathJax-Span-532" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mi" id="MathJax-Span-533" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-534"></span><span class="mi" id="MathJax-Span-535" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span><span class="mi" id="MathJax-Span-536" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-537"></span><span class="mi" id="MathJax-Span-538" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.127em, 1017.66em, 4.338em, -999.998em); top: -2.498em; left: 50%; margin-left: -8.826em;"><span class="mtd" id="MathJax-Span-539"><span class="mrow" id="MathJax-Span-540"><span class="mi" id="MathJax-Span-541" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-542"></span><span class="mi" id="MathJax-Span-543" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mo" id="MathJax-Span-544" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-545"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-546" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-547" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-548" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-549" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-550" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-551" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-552" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-553"></span><span class="mi" id="MathJax-Span-554" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-555" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-556" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-557"></span><span class="mi" id="MathJax-Span-558" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span><span class="mo" id="MathJax-Span-559" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-560" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-561" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-562" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-563" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-564"></span><span class="mi" id="MathJax-Span-565" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mi" id="MathJax-Span-566" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-567"></span><span class="mi" id="MathJax-Span-568" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.885em;"></span></span></span></span><span class="mo" id="MathJax-Span-569" style="vertical-align: 2.229em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.662em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.717em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.248em; border-left: 0px solid; width: 0px; height: 5.152em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>x</mi></mtd></mtr><mtr><mtd><mi>y</mi></mtd></mtr><mtr><mtd><mi>z</mi></mtd></mtr></mtable><mo>)</mo></mrow><mo>=</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mo stretchy="false">(</mo><msub><mi>R</mi><mn>2</mn></msub><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>cos</mi><mo>⁡</mo><mi>B</mi><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi><mo>+</mo><mi>sin</mi><mo>⁡</mo><mi>A</mi><mi>sin</mi><mo>⁡</mo><mi>B</mi><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi><mo stretchy="false">)</mo><mo>−</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>A</mi><mi>sin</mi><mo>⁡</mo><mi>B</mi><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mtd></mtr><mtr><mtd><mo stretchy="false">(</mo><msub><mi>R</mi><mn>2</mn></msub><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi><mi>sin</mi><mo>⁡</mo><mi>B</mi><mo>−</mo><mi>cos</mi><mo>⁡</mo><mi>B</mi><mi>sin</mi><mo>⁡</mo><mi>A</mi><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>A</mi><mi>cos</mi><mo>⁡</mo><mi>B</mi><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mtd></mtr><mtr><mtd><mi>cos</mi><mo>⁡</mo><mi>A</mi><mo stretchy="false">(</mo><msub><mi>R</mi><mn>2</mn></msub><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><mi>A</mi><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mtd></mtr></mtable><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-9">\left( \begin{matrix} x \\ y \\ z \end{matrix} \right) =
\left( \begin{matrix}
 (R_2 + R_1 \cos \theta) (\cos B \cos \phi + \sin A \sin B \sin \phi) - 
   R_1 \cos A \sin B \sin \theta \\

 (R_2 + R_1 \cos \theta) (\cos \phi \sin B - \cos B \sin A \sin \phi) + 
   R_1 \cos A \cos B \sin \theta \\
 \cos A (R_2 + R_1 \cos \theta) \sin \phi + R_1 \sin A \sin \theta
\end{matrix} \right)</script>

<p>Well, that looks pretty hideous, but we we can precompute some common
subexpressions (e.g. all the sines and cosines, and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-570" style="width: 7.307em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.705em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(1.447em, 1005.71em, 2.541em, -999.998em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-571"><span class="msubsup" id="MathJax-Span-572"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-573" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-574" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-575" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="msubsup" id="MathJax-Span-576" style="padding-left: 0.236em;"><span style="display: inline-block; position: relative; width: 1.174em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.74em, 4.143em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-577" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.744em;"><span class="mn" id="MathJax-Span-578" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mi" id="MathJax-Span-579" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-580"></span><span class="mi" id="MathJax-Span-581" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.203em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mn>2</mn></msub><mo>+</mo><msub><mi>R</mi><mn>1</mn></msub><mi>cos</mi><mo>⁡</mo><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">R_2 + R_1 \cos \theta</script>)
and reuse them in the code.  In fact I came up with a completely different
factoring in the original code but that’s left as an exercise for the reader.
(The original code also swaps the sines and cosines of A, effectively rotating
by 90 degrees, so I guess my initial derivation was a bit different but that’s
OK.)</p>

<p>Now we know where to put the pixel, but we still haven’t even considered which
shade to plot.  To calculate illumination, we need to know the <a href="http://en.wikipedia.org/wiki/Surface_normal">surface normal</a> —
the direction perpendicular to the surface at each point.  If we have that,
then we can take the <a href="http://en.wikipedia.org/wiki/Dot_product">dot
product</a> of the surface normal with the light direction, which we can choose
arbitrarily.  That gives us the cosine of the angle between the light direction
and the surface direction: If the dot product is &gt;0, the surface is facing
the light and if it’s &lt;0, it faces away from the light.  The higher the
value, the more light falls on the surface.</p>

<p>The derivation of the surface normal direction turns out to be pretty much the
same as our derivation of the point in space.  We start with a point on a
circle, rotate it around the torus’s central axis, and then make two more
rotations.  The surface normal of the point on the circle is fairly obvious:
it’s the same as the point on a unit (radius=1) circle centered at the origin.</p>

<p>So our surface normal (<em>N<sub>x</sub></em>, <em>N<sub>y</sub></em>, <em>N<sub>z</sub></em>) is
derived the same as above, except the point we start with is just (cos
<em>θ</em>, sin <em>θ</em>, 0).  Then we apply the same rotations:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-582" style="width: 61.721em; display: inline-block;"><span style="display: inline-block; position: relative; width: 48.205em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(2.15em, 1047.93em, 6.174em, -999.998em); top: -4.412em; left: 0em;"><span class="mrow" id="MathJax-Span-583"><span class="mrow" id="MathJax-Span-584"><span class="mo" id="MathJax-Span-585" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mtable" id="MathJax-Span-586" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 6.291em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1001.49em, 4.299em, -999.998em); top: -3.982em; left: 0em;"><span style="display: inline-block; position: relative; width: 1.564em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1001.49em, 4.299em, -999.998em); top: -3.982em; left: 50%; margin-left: -0.779em;"><span class="mtd" id="MathJax-Span-587"><span class="mrow" id="MathJax-Span-588"><span class="msubsup" id="MathJax-Span-589"><span style="display: inline-block; position: relative; width: 1.291em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-590" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.08em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.822em;"><span class="mi" id="MathJax-Span-591" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-592" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1001.45em, 4.416em, -999.998em); top: -3.982em; left: 2.58em;"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1001.45em, 4.416em, -999.998em); top: -3.982em; left: 50%; margin-left: -0.74em;"><span class="mtd" id="MathJax-Span-593"><span class="mrow" id="MathJax-Span-594"><span class="msubsup" id="MathJax-Span-595"><span style="display: inline-block; position: relative; width: 1.213em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-596" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.08em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.822em;"><span class="mi" id="MathJax-Span-597" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-598" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1001.21em, 4.26em, -999.998em); top: -3.982em; left: 5.08em;"><span style="display: inline-block; position: relative; width: 1.213em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1001.21em, 4.26em, -999.998em); top: -3.982em; left: 50%; margin-left: -0.584em;"><span class="mtd" id="MathJax-Span-599"><span class="mrow" id="MathJax-Span-600"><span class="msubsup" id="MathJax-Span-601"><span style="display: inline-block; position: relative; width: 1.213em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-602" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.08em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.822em;"><span class="mi" id="MathJax-Span-603" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-604" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-605" style="font-family: MathJax_Main; padding-left: 0.275em;">=</span><span class="mrow" id="MathJax-Span-606" style="padding-left: 0.275em;"><span class="mo" id="MathJax-Span-607" style="font-family: MathJax_Main;">(</span><span class="mtable" id="MathJax-Span-608" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 6.877em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1002.19em, 4.338em, -999.998em); top: -3.982em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.229em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1002.19em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.131em;"><span class="mtd" id="MathJax-Span-609"><span class="mrow" id="MathJax-Span-610"><span class="mi" id="MathJax-Span-611" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-612"></span><span class="mi" id="MathJax-Span-613" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-614" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1002.07em, 4.338em, -999.998em); top: -3.982em; left: 3.244em;"><span style="display: inline-block; position: relative; width: 2.15em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1002.07em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-615"><span class="mrow" id="MathJax-Span-616"><span class="mi" id="MathJax-Span-617" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-618"></span><span class="mi" id="MathJax-Span-619" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-620" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.244em, 1000.47em, 4.182em, -999.998em); top: -3.982em; left: 6.369em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-621"><span class="mrow" id="MathJax-Span-622"><span class="mn" id="MathJax-Span-623" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-624" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-625" style="font-family: MathJax_Main; padding-left: 0.236em;">⋅</span><span class="mrow" id="MathJax-Span-626" style="padding-left: 0.236em;"><span class="mo" id="MathJax-Span-627" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mtable" id="MathJax-Span-628" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 7.502em; height: 0px;"><span style="position: absolute; clip: rect(2.541em, 1002.89em, 6.447em, -999.998em); top: -4.686em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.932em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1002.07em, 4.299em, -999.998em); top: -5.35em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-629"><span class="mrow" id="MathJax-Span-630"><span class="mi" id="MathJax-Span-631" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-632"></span><span class="mi" id="MathJax-Span-633" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-642"><span class="mrow" id="MathJax-Span-643"><span class="mn" id="MathJax-Span-644" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.89em, 4.299em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.443em;"><span class="mtd" id="MathJax-Span-651"><span class="mrow" id="MathJax-Span-652"><span class="mo" id="MathJax-Span-653" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-654" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-655"></span><span class="mi" id="MathJax-Span-656" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.689em;"></span></span><span style="position: absolute; clip: rect(2.346em, 1000.47em, 6.096em, -999.998em); top: -4.49em; left: 3.908em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-634"><span class="mrow" id="MathJax-Span-635"><span class="mn" id="MathJax-Span-636" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.43em, 4.104em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-645"><span class="mrow" id="MathJax-Span-646"><span class="mn" id="MathJax-Span-647" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-657"><span class="mrow" id="MathJax-Span-658"><span class="mn" id="MathJax-Span-659" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span><span style="position: absolute; clip: rect(2.541em, 1002.07em, 6.447em, -999.998em); top: -4.686em; left: 5.432em;"><span style="display: inline-block; position: relative; width: 2.111em; height: 0px;"><span style="position: absolute; clip: rect(3.166em, 1001.96em, 4.299em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.975em;"><span class="mtd" id="MathJax-Span-637"><span class="mrow" id="MathJax-Span-638"><span class="mi" id="MathJax-Span-639" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-640"></span><span class="mi" id="MathJax-Span-641" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-648"><span class="mrow" id="MathJax-Span-649"><span class="mn" id="MathJax-Span-650" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.07em, 4.299em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-660"><span class="mrow" id="MathJax-Span-661"><span class="mi" id="MathJax-Span-662" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-663"></span><span class="mi" id="MathJax-Span-664" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.689em;"></span></span></span></span><span class="mo" id="MathJax-Span-665" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-666" style="font-family: MathJax_Main; padding-left: 0.236em;">⋅</span><span class="mrow" id="MathJax-Span-667" style="padding-left: 0.236em;"><span class="mo" id="MathJax-Span-668" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mtable" id="MathJax-Span-669" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 7.814em; height: 0px;"><span style="position: absolute; clip: rect(2.346em, 1000.47em, 6.096em, -999.998em); top: -4.49em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.43em, 4.104em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-670"><span class="mrow" id="MathJax-Span-671"><span class="mn" id="MathJax-Span-672" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-679"><span class="mrow" id="MathJax-Span-680"><span class="mn" id="MathJax-Span-681" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-692"><span class="mrow" id="MathJax-Span-693"><span class="mn" id="MathJax-Span-694" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span><span style="position: absolute; clip: rect(2.385em, 1003.05em, 6.174em, -999.998em); top: -4.529em; left: 1.486em;"><span style="display: inline-block; position: relative; width: 3.088em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-673"><span class="mrow" id="MathJax-Span-674"><span class="mn" id="MathJax-Span-675" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.23em, 4.104em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.131em;"><span class="mtd" id="MathJax-Span-682"><span class="mrow" id="MathJax-Span-683"><span class="mi" id="MathJax-Span-684" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-685"></span><span class="mi" id="MathJax-Span-686" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1003.05em, 4.182em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.521em;"><span class="mtd" id="MathJax-Span-695"><span class="mrow" id="MathJax-Span-696"><span class="mo" id="MathJax-Span-697" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-698" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-699"></span><span class="mi" id="MathJax-Span-700" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.533em;"></span></span><span style="position: absolute; clip: rect(2.346em, 1002.23em, 6.057em, -999.998em); top: -4.49em; left: 5.588em;"><span style="display: inline-block; position: relative; width: 2.229em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-676"><span class="mrow" id="MathJax-Span-677"><span class="mn" id="MathJax-Span-678" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.11em, 4.104em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-687"><span class="mrow" id="MathJax-Span-688"><span class="mi" id="MathJax-Span-689" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-690"></span><span class="mi" id="MathJax-Span-691" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.166em, 1002.23em, 4.104em, -999.998em); top: -2.537em; left: 50%; margin-left: -1.131em;"><span class="mtd" id="MathJax-Span-701"><span class="mrow" id="MathJax-Span-702"><span class="mi" id="MathJax-Span-703" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-704"></span><span class="mi" id="MathJax-Span-705" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span></span></span><span class="mo" id="MathJax-Span-706" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-707" style="font-family: MathJax_Main; padding-left: 0.236em;">⋅</span><span class="mrow" id="MathJax-Span-708" style="padding-left: 0.236em;"><span class="mo" id="MathJax-Span-709" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎛<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎝<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎜<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mtable" id="MathJax-Span-710" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 7.854em; height: 0px;"><span style="position: absolute; clip: rect(2.346em, 1003.09em, 6.096em, -999.998em); top: -4.49em; left: 0em;"><span style="display: inline-block; position: relative; width: 3.088em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1002.27em, 4.104em, -999.998em); top: -5.35em; left: 50%; margin-left: -1.131em;"><span class="mtd" id="MathJax-Span-711"><span class="mrow" id="MathJax-Span-712"><span class="mi" id="MathJax-Span-713" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-714"></span><span class="mi" id="MathJax-Span-715" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1003.09em, 4.182em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.521em;"><span class="mtd" id="MathJax-Span-724"><span class="mrow" id="MathJax-Span-725"><span class="mo" id="MathJax-Span-726" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-727" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-728"></span><span class="mi" id="MathJax-Span-729" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-738"><span class="mrow" id="MathJax-Span-739"><span class="mn" id="MathJax-Span-740" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span><span style="position: absolute; clip: rect(2.346em, 1002.27em, 6.096em, -999.998em); top: -4.49em; left: 4.064em;"><span style="display: inline-block; position: relative; width: 2.268em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1002.15em, 4.104em, -999.998em); top: -5.35em; left: 50%; margin-left: -1.053em;"><span class="mtd" id="MathJax-Span-716"><span class="mrow" id="MathJax-Span-717"><span class="mi" id="MathJax-Span-718" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-719"></span><span class="mi" id="MathJax-Span-720" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1002.27em, 4.104em, -999.998em); top: -3.943em; left: 50%; margin-left: -1.131em;"><span class="mtd" id="MathJax-Span-730"><span class="mrow" id="MathJax-Span-731"><span class="mi" id="MathJax-Span-732" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-733"></span><span class="mi" id="MathJax-Span-734" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-741"><span class="mrow" id="MathJax-Span-742"><span class="mn" id="MathJax-Span-743" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.494em;"></span></span><span style="position: absolute; clip: rect(2.307em, 1000.47em, 6.018em, -999.998em); top: -4.451em; left: 7.346em;"><span style="display: inline-block; position: relative; width: 0.51em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -5.35em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-721"><span class="mrow" id="MathJax-Span-722"><span class="mn" id="MathJax-Span-723" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.47em, 4.143em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-735"><span class="mrow" id="MathJax-Span-736"><span class="mn" id="MathJax-Span-737" style="font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1000.43em, 4.104em, -999.998em); top: -2.537em; left: 50%; margin-left: -0.232em;"><span class="mtd" id="MathJax-Span-744"><span class="mrow" id="MathJax-Span-745"><span class="mn" id="MathJax-Span-746" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.455em;"></span></span></span></span><span class="mo" id="MathJax-Span-747" style="vertical-align: 2.15em;"><span style="display: inline-block; position: relative; width: 0.861em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -2.811em; left: 0em;">⎞<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.818em; left: 0em;">⎠<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -1.795em; left: 0em;">⎟<span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.416em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.147em; border-left: 0px solid; width: 0px; height: 5.002em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><msub><mi>N</mi><mi>x</mi></msub><mo>,</mo></mtd><mtd><msub><mi>N</mi><mi>y</mi></msub><mo>,</mo></mtd><mtd><msub><mi>N</mi><mi>z</mi></msub></mtd></mtr></mtable><mo>)</mo></mrow><mo>=</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>,</mo></mtd><mtd><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>,</mo></mtd><mtd><mn>0</mn></mtd></mtr></mtable><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi></mtd><mtd><mn>0</mn></mtd><mtd><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mn>1</mn></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi></mtd><mtd><mn>0</mn></mtd><mtd><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi></mtd></mtr></mtable><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mn>1</mn></mtd><mtd><mn>0</mn></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mi>cos</mi><mo>⁡</mo><mi>A</mi></mtd><mtd><mi>sin</mi><mo>⁡</mo><mi>A</mi></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>A</mi></mtd><mtd><mi>cos</mi><mo>⁡</mo><mi>A</mi></mtd></mtr></mtable><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>cos</mi><mo>⁡</mo><mi>B</mi></mtd><mtd><mi>sin</mi><mo>⁡</mo><mi>B</mi></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>B</mi></mtd><mtd><mi>cos</mi><mo>⁡</mo><mi>B</mi></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mn>0</mn></mtd><mtd><mn>1</mn></mtd></mtr></mtable><mo>)</mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-11">\left( \begin{matrix}
N_x, &
N_y, &
N_z \end{matrix} \right)
=
\left( \begin{matrix}
\cos \theta, &
\sin \theta, &
0 \end{matrix} \right)
\cdot
\left( \begin{matrix}
\cos \phi & 0 & \sin \phi \\
0 & 1 & 0 \\
-\sin \phi & 0 & \cos \phi \end{matrix} \right)
\cdot
\left( \begin{matrix}
1 & 0 & 0 \\
0 & \cos A & \sin A \\
0 & -\sin A & \cos A \end{matrix} \right)
\cdot
\left( \begin{matrix}
\cos B & \sin B & 0 \\
-\sin B & \cos B & 0 \\
0 & 0 & 1 \end{matrix} \right)</script>

<p>So which lighting direction should we choose?  How about we light up surfaces
facing behind and above the viewer: <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-748" style="width: 5.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.947em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(1.408em, 1003.87em, 2.619em, -999.998em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-749"><span class="mo" id="MathJax-Span-750" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-751" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-752" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-753" style="font-family: MathJax_Main; padding-left: 0.158em;">1</span><span class="mo" id="MathJax-Span-754" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-755" style="font-family: MathJax_Main; padding-left: 0.158em;">−</span><span class="mn" id="MathJax-Span-756" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-757" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.348em; border-left: 0px solid; width: 0px; height: 1.403em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-12">(0,1,-1)</script>.  Technically
this should be a normalized unit vector, and this vector has a magnitude of
√2.  That’s okay – we will compensate later.  Therefore we compute the
above (<em>x</em>,<em>y</em>,<em>z</em>), throw away the <em>x</em> and get our luminance <em>L</em> = <em>y</em>-<em>z</em>.</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left right left right left right left right left right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-758" style="width: 48.908em; display: inline-block;"><span style="display: inline-block; position: relative; width: 38.205em; height: 0px; font-size: 128%;"><span style="position: absolute; clip: rect(0.666em, 1037.97em, 3.361em, -999.998em); top: -2.264em; left: 0em;"><span class="mrow" id="MathJax-Span-759"><span class="mtable" id="MathJax-Span-760" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 37.893em; height: 0px;"><span style="position: absolute; clip: rect(2.502em, 1000.67em, 4.846em, -999.998em); top: -3.982em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.666em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.67em, 4.104em, -999.998em); top: -4.646em; right: 0em;"><span class="mtd" id="MathJax-Span-761"><span class="mrow" id="MathJax-Span-762"><span class="mi" id="MathJax-Span-763" style="font-family: MathJax_Math-italic;">L</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.869em, 1000em, 4.104em, -999.998em); top: -3.24em; right: 0em;"><span class="mtd" id="MathJax-Span-806"><span class="mrow" id="MathJax-Span-807"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(2.385em, 1037.11em, 5.08em, -999.998em); top: -3.982em; left: 0.666em;"><span style="display: inline-block; position: relative; width: 37.189em; height: 0px;"><span style="position: absolute; clip: rect(3.088em, 1015.27em, 4.416em, -999.998em); top: -4.646em; left: 0em;"><span class="mtd" id="MathJax-Span-764"><span class="mrow" id="MathJax-Span-765"><span class="mi" id="MathJax-Span-766"></span><span class="mo" id="MathJax-Span-767" style="font-family: MathJax_Main; padding-left: 0.275em;">=</span><span class="mrow" id="MathJax-Span-768" style="padding-left: 0.275em;"><span class="mo" id="MathJax-Span-769" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mtable" id="MathJax-Span-770" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 6.291em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1001.49em, 4.299em, -999.998em); top: -3.982em; left: 0em;"><span style="display: inline-block; position: relative; width: 1.564em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1001.49em, 4.299em, -999.998em); top: -3.982em; left: 50%; margin-left: -0.779em;"><span class="mtd" id="MathJax-Span-771"><span class="mrow" id="MathJax-Span-772"><span class="msubsup" id="MathJax-Span-773"><span style="display: inline-block; position: relative; width: 1.291em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-774" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.08em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.822em;"><span class="mi" id="MathJax-Span-775" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-776" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1001.45em, 4.416em, -999.998em); top: -3.982em; left: 2.58em;"><span style="display: inline-block; position: relative; width: 1.525em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1001.45em, 4.416em, -999.998em); top: -3.982em; left: 50%; margin-left: -0.74em;"><span class="mtd" id="MathJax-Span-777"><span class="mrow" id="MathJax-Span-778"><span class="msubsup" id="MathJax-Span-779"><span style="display: inline-block; position: relative; width: 1.213em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-780" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.08em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.822em;"><span class="mi" id="MathJax-Span-781" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-782" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.205em, 1001.21em, 4.26em, -999.998em); top: -3.982em; left: 5.08em;"><span style="display: inline-block; position: relative; width: 1.213em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1001.21em, 4.26em, -999.998em); top: -3.982em; left: 50%; margin-left: -0.584em;"><span class="mtd" id="MathJax-Span-783"><span class="mrow" id="MathJax-Span-784"><span class="msubsup" id="MathJax-Span-785"><span style="display: inline-block; position: relative; width: 1.213em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.9em, 4.104em, -999.998em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-786" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.08em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; top: -3.826em; left: 0.822em;"><span class="mi" id="MathJax-Span-787" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-788" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-789" style="font-family: MathJax_Main; padding-left: 0.236em;">⋅</span><span class="mrow" id="MathJax-Span-790" style="padding-left: 0.236em;"><span class="mo" id="MathJax-Span-791" style="font-family: MathJax_Main;">(</span><span class="mtable" id="MathJax-Span-792" style="padding-right: 0.158em; padding-left: 0.158em;"><span style="display: inline-block; position: relative; width: 4.846em; height: 0px;"><span style="position: absolute; clip: rect(3.244em, 1000.71em, 4.338em, -999.998em); top: -3.982em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.783em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.71em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.389em;"><span class="mtd" id="MathJax-Span-793"><span class="mrow" id="MathJax-Span-794"><span class="mn" id="MathJax-Span-795" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-796" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.244em, 1000.71em, 4.338em, -999.998em); top: -3.982em; left: 1.799em;"><span style="display: inline-block; position: relative; width: 0.783em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.71em, 4.299em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.389em;"><span class="mtd" id="MathJax-Span-797"><span class="mrow" id="MathJax-Span-798"><span class="mn" id="MathJax-Span-799" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-800" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.244em, 1001.21em, 4.221em, -999.998em); top: -3.982em; left: 3.557em;"><span style="display: inline-block; position: relative; width: 1.291em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1001.21em, 4.182em, -999.998em); top: -3.943em; left: 50%; margin-left: -0.623em;"><span class="mtd" id="MathJax-Span-801"><span class="mrow" id="MathJax-Span-802"><span class="mo" id="MathJax-Span-803" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-804" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span><span class="mo" id="MathJax-Span-805" style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span><span style="position: absolute; clip: rect(3.127em, 1037.11em, 4.338em, -999.998em); top: -3.24em; left: 0em;"><span class="mtd" id="MathJax-Span-808"><span class="mrow" id="MathJax-Span-809"><span class="mi" id="MathJax-Span-810"></span><span class="mo" id="MathJax-Span-811" style="font-family: MathJax_Main; padding-left: 0.275em;">=</span><span class="mi" id="MathJax-Span-812" style="font-family: MathJax_Main; padding-left: 0.275em;">cos</span><span class="mo" id="MathJax-Span-813"></span><span class="mi" id="MathJax-Span-814" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span><span class="mi" id="MathJax-Span-815" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-816"></span><span class="mi" id="MathJax-Span-817" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mi" id="MathJax-Span-818" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-819"></span><span class="mi" id="MathJax-Span-820" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span><span class="mo" id="MathJax-Span-821" style="font-family: MathJax_Main; padding-left: 0.236em;">−</span><span class="mi" id="MathJax-Span-822" style="font-family: MathJax_Main; padding-left: 0.236em;">cos</span><span class="mo" id="MathJax-Span-823"></span><span class="mi" id="MathJax-Span-824" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mi" id="MathJax-Span-825" style="font-family: MathJax_Main; padding-left: 0.158em;">cos</span><span class="mo" id="MathJax-Span-826"></span><span class="mi" id="MathJax-Span-827" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mi" id="MathJax-Span-828" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-829"></span><span class="mi" id="MathJax-Span-830" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span><span class="mo" id="MathJax-Span-831" style="font-family: MathJax_Main; padding-left: 0.236em;">−</span><span class="mi" id="MathJax-Span-832" style="font-family: MathJax_Main; padding-left: 0.236em;">sin</span><span class="mo" id="MathJax-Span-833"></span><span class="mi" id="MathJax-Span-834" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mi" id="MathJax-Span-835" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-836"></span><span class="mi" id="MathJax-Span-837" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-838" style="font-family: MathJax_Main; padding-left: 0.236em;">+</span><span class="mi" id="MathJax-Span-839" style="font-family: MathJax_Main; padding-left: 0.236em;">cos</span><span class="mo" id="MathJax-Span-840"></span><span class="mi" id="MathJax-Span-841" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">B</span><span class="mo" id="MathJax-Span-842" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-843" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-844"></span><span class="mi" id="MathJax-Span-845" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mi" id="MathJax-Span-846" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-847"></span><span class="mi" id="MathJax-Span-848" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mo" id="MathJax-Span-849" style="font-family: MathJax_Main; padding-left: 0.236em;">−</span><span class="mi" id="MathJax-Span-850" style="font-family: MathJax_Main; padding-left: 0.236em;">cos</span><span class="mo" id="MathJax-Span-851"></span><span class="mi" id="MathJax-Span-852" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">θ</span><span class="mi" id="MathJax-Span-853" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-854"></span><span class="mi" id="MathJax-Span-855" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">A</span><span class="mi" id="MathJax-Span-856" style="font-family: MathJax_Main; padding-left: 0.158em;">sin</span><span class="mo" id="MathJax-Span-857"></span><span class="mi" id="MathJax-Span-858" style="font-family: MathJax_Math-italic; padding-left: 0.158em;">ϕ</span><span class="mo" id="MathJax-Span-859" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.986em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.297em; border-left: 0px solid; width: 0px; height: 3.252em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mtr><mtd><mi>L</mi></mtd><mtd><mi></mi><mo>=</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><msub><mi>N</mi><mi>x</mi></msub><mo>,</mo></mtd><mtd><msub><mi>N</mi><mi>y</mi></msub><mo>,</mo></mtd><mtd><msub><mi>N</mi><mi>z</mi></msub></mtd></mtr></mtable><mo>)</mo></mrow><mo>⋅</mo><mrow><mo>(</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mn>0</mn><mo>,</mo></mtd><mtd><mn>1</mn><mo>,</mo></mtd><mtd><mo>−</mo><mn>1</mn></mtd></mtr></mtable><mo>)</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd><mi></mi><mo>=</mo><mi>cos</mi><mo>⁡</mo><mi>ϕ</mi><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mi>sin</mi><mo>⁡</mo><mi>B</mi><mo>−</mo><mi>cos</mi><mo>⁡</mo><mi>A</mi><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>A</mi><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>+</mo><mi>cos</mi><mo>⁡</mo><mi>B</mi><mo stretchy="false">(</mo><mi>cos</mi><mo>⁡</mo><mi>A</mi><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>−</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mi>sin</mi><mo>⁡</mo><mi>A</mi><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi><mo stretchy="false">)</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-13">\begin{aligned}
L &=
\left( \begin{matrix}
N_x, &
N_y, &
N_z \end{matrix} \right)
\cdot
\left( \begin{matrix}
0, &
1, &
-1 \end{matrix} \right)
\\
&= 
\cos \phi \cos \theta \sin B - \cos A \cos \theta \sin \phi - \sin A \sin \theta + 
 \cos B ( \cos A \sin \theta - \cos \theta \sin A \sin \phi)
\end{aligned}</script>

<p>Again, not too pretty, but not terrible once we’ve precomputed all the sines
and cosines.</p>

<p>So now all that’s left to do is to pick some values for <em>R</em><sub>1</sub>,
<em>R</em><sub>2</sub>, <em>K</em><sub>1</sub>, and <em>K</em><sub>2</sub>.  In the original donut
code I chose <em>R</em><sub>1</sub>=1 and <em>R</em><sub>2</sub>=2, so it has the same
geometry as my cross-section diagram above.  <em>K<sub>1</sub></em> controls the
scale, which depends on our pixel resolution and is in fact different for <em>x</em>
and <em>y</em> in the ASCII animation.  <em>K</em><sub>2</sub>, the distance from the viewer
to the donut, was chosen to be 5.</p>

<p>I’ve taken the above equations and written a quick and dirty canvas
implementation here, just plotting the pixels and the lighting values from the
equations above.  The result is not exactly the same as the original as some of
my rotations are in opposite directions or off by 90 degrees, but it is
qualitatively doing the same thing.</p>

<p>Here it is: <button onclick="anim2();">toggle animation</button></p>

<canvas id="canvasdonut" width="300" height="240">
</canvas>

<p>It’s slightly mind-bending because you can see right through the torus, but the
math does work!  Convert that to an ASCII rendering with <em>z</em>-buffering, and
you’ve got yourself a clever little program.</p>

<p>Now, we have all the pieces, but how do we write the code?  Roughly like this
(some pseudocode liberties have been taken with 2D arrays):</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">const</span> <span class="kt">float</span> <span class="n">theta_spacing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">07</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">phi_spacing</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">02</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">R1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">R2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">K2</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="c1">// Calculate K1 based on screen size: the maximum x-distance occurs</span>
<span class="c1">// roughly at the edge of the torus, which is at x=R1+R2, z=0.  we</span>
<span class="c1">// want that to be displaced 3/8ths of the width of the screen, which</span>
<span class="c1">// is 3/4th of the way from the center to the side of the screen.</span>
<span class="c1">// screen_width*3/8 = K1*(R1+R2)/(K2+0)</span>
<span class="c1">// screen_width*K2*3/(8*(R1+R2)) = K1</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">K1</span> <span class="o">=</span> <span class="n">screen_width</span><span class="o">*</span><span class="n">K2</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="n">R1</span><span class="o">+</span><span class="n">R2</span><span class="p">));</span>

<span class="n">render_frame</span><span class="p">(</span><span class="kt">float</span> <span class="n">A</span><span class="p">,</span> <span class="kt">float</span> <span class="n">B</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// precompute sines and cosines of A and B</span>
  <span class="kt">float</span> <span class="n">cosA</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">sinA</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">cosB</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">B</span><span class="p">),</span> <span class="n">sinB</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>

  <span class="kt">char</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="n">screen_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">..</span><span class="n">screen_height</span><span class="p">]</span> <span class="o">=</span> <span class="sc">' '</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">zbuffer</span><span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="n">screen_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">..</span><span class="n">screen_height</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// theta goes around the cross-sectional circle of a torus</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">float</span> <span class="n">theta</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">;</span> <span class="n">theta</span> <span class="o">+=</span> <span class="n">theta_spacing</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// precompute sines and cosines of theta</span>
    <span class="kt">float</span> <span class="n">costheta</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">sintheta</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>

    <span class="c1">// phi goes around the center of revolution of a torus</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">phi</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">phi</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">;</span> <span class="n">phi</span> <span class="o">+=</span> <span class="n">phi_spacing</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// precompute sines and cosines of phi</span>
      <span class="kt">float</span> <span class="n">cosphi</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">sinphi</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">);</span>
    
      <span class="c1">// the x,y coordinate of the circle, before revolving (factored</span>
      <span class="c1">// out of the above equations)</span>
      <span class="kt">float</span> <span class="n">circlex</span> <span class="o">=</span> <span class="n">R2</span> <span class="o">+</span> <span class="n">R1</span><span class="o">*</span><span class="n">costheta</span><span class="p">;</span>
      <span class="kt">float</span> <span class="n">circley</span> <span class="o">=</span> <span class="n">R1</span><span class="o">*</span><span class="n">sintheta</span><span class="p">;</span>

      <span class="c1">// final 3D (x,y,z) coordinate after rotations, directly from</span>
      <span class="c1">// our math above</span>
      <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">circlex</span><span class="o">*</span><span class="p">(</span><span class="n">cosB</span><span class="o">*</span><span class="n">cosphi</span> <span class="o">+</span> <span class="n">sinA</span><span class="o">*</span><span class="n">sinB</span><span class="o">*</span><span class="n">sinphi</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">circley</span><span class="o">*</span><span class="n">cosA</span><span class="o">*</span><span class="n">sinB</span><span class="p">;</span> 
      <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">circlex</span><span class="o">*</span><span class="p">(</span><span class="n">sinB</span><span class="o">*</span><span class="n">cosphi</span> <span class="o">-</span> <span class="n">sinA</span><span class="o">*</span><span class="n">cosB</span><span class="o">*</span><span class="n">sinphi</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">circley</span><span class="o">*</span><span class="n">cosA</span><span class="o">*</span><span class="n">cosB</span><span class="p">;</span>
      <span class="kt">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">K2</span> <span class="o">+</span> <span class="n">cosA</span><span class="o">*</span><span class="n">circlex</span><span class="o">*</span><span class="n">sinphi</span> <span class="o">+</span> <span class="n">circley</span><span class="o">*</span><span class="n">sinA</span><span class="p">;</span>
      <span class="kt">float</span> <span class="n">ooz</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">z</span><span class="p">;</span>  <span class="c1">// "one over z"</span>
      
      <span class="c1">// x and y projection.  note that y is negated here, because y</span>
      <span class="c1">// goes up in 3D space but down on 2D displays.</span>
      <span class="kt">int</span> <span class="n">xp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">screen_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">K1</span><span class="o">*</span><span class="n">ooz</span><span class="o">*</span><span class="n">x</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">yp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">screen_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">K1</span><span class="o">*</span><span class="n">ooz</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>
      
      <span class="c1">// calculate luminance.  ugly, but correct.</span>
      <span class="kt">float</span> <span class="n">L</span> <span class="o">=</span> <span class="n">cosphi</span><span class="o">*</span><span class="n">costheta</span><span class="o">*</span><span class="n">sinB</span> <span class="o">-</span> <span class="n">cosA</span><span class="o">*</span><span class="n">costheta</span><span class="o">*</span><span class="n">sinphi</span> <span class="o">-</span>
        <span class="n">sinA</span><span class="o">*</span><span class="n">sintheta</span> <span class="o">+</span> <span class="n">cosB</span><span class="o">*</span><span class="p">(</span><span class="n">cosA</span><span class="o">*</span><span class="n">sintheta</span> <span class="o">-</span> <span class="n">costheta</span><span class="o">*</span><span class="n">sinA</span><span class="o">*</span><span class="n">sinphi</span><span class="p">);</span>
      <span class="c1">// L ranges from -sqrt(2) to +sqrt(2).  If it's &lt; 0, the surface</span>
      <span class="c1">// is pointing away from us, so we won't bother trying to plot it.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">L</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// test against the z-buffer.  larger 1/z means the pixel is</span>
        <span class="c1">// closer to the viewer than what's already plotted.</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ooz</span> <span class="o">&gt;</span> <span class="n">zbuffer</span><span class="p">[</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">])</span> <span class="p">{</span>
          <span class="n">zbuffer</span><span class="p">[</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">]</span> <span class="o">=</span> <span class="n">ooz</span><span class="p">;</span>
          <span class="kt">int</span> <span class="n">luminance_index</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="mi">8</span><span class="p">;</span>
          <span class="c1">// luminance_index is now in the range 0..11 (8*sqrt(2) = 11.3)</span>
          <span class="c1">// now we lookup the character corresponding to the</span>
          <span class="c1">// luminance and plot it in our output:</span>
          <span class="n">output</span><span class="p">[</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">]</span> <span class="o">=</span> <span class="s">".,-~:;=!*#$@"</span><span class="p">[</span><span class="n">luminance_index</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// now, dump output[] to the screen.</span>
  <span class="c1">// bring cursor to "home" location, in just about any currently-used</span>
  <span class="c1">// terminal emulation mode</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\x1b</span><span class="s">[H"</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">screen_height</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">screen_width</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">putchar</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">putchar</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
  <span class="p">}</span>
  
<span class="p">}</span></code></pre></figure>

<p>The Javascript source for both the ASCII and canvas rendering is <a href="./Donut math_ how donut.c works – a1k0n.net_files/donut.js">right here</a>.</p>


</article>







      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <a href="https://www.a1k0n.net/" class="site-title">a1k0n.net</a>
  </div>
</footer>



<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Size3, sans-serif;"></div></div></body><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration></html>